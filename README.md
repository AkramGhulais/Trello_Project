# نظام إدارة المهام والمشاريع (Trello-like)

نظام متكامل لإدارة المشاريع والمهام مشابه لـ Trello مع دعم تعدد المؤسسات، تحديثات فورية، وواجهة مستخدم عصرية باستخدام Material-UI.

## الميزات الرئيسية

- **تعدد المؤسسات**: نظام متعدد المستأجرين يتيح فصل مساحات العمل لكل مؤسسة
- **تحديثات فورية**: تكامل WebSocket لعرض التغييرات بشكل لحظي
- **واجهة مستخدم عصرية**: استخدام مكونات Material-UI لواجهة احترافية
- **نظام صلاحيات متقدم**: تحكم في الوصول على أساس الأدوار
- **تصميم متجاوب**: يعمل على جميع أحجام الشاشات
- **نظام تعليقات متكامل**: إمكانية إضافة وتعديل التعليقات على المهام
- **تتبع حالة المهام**: إدارة حالات المهام (قيد الانتظار، قيد التنفيذ، مكتملة)
- **تحديد أولويات المهام**: تصنيف المهام حسب الأولوية (منخفضة، متوسطة، عالية)

## التقنيات المستخدمة

### الواجهة الأمامية (Frontend)
- **React + Vite**: إطار عمل JavaScript لبناء واجهات المستخدم
- **Material-UI (MUI)**: مكتبة مكونات React متوافقة مع تصميم Material Design
- **Context API**: لإدارة حالة التطبيق وتبادل البيانات بين المكونات
- **WebSocket**: لتنفيذ التحديثات الفورية والتواصل ثنائي الاتجاه مع الخادم

### الخادم الخلفي (Backend)
- **Django**: إطار عمل Python لتطوير تطبيقات الويب
- **Django REST Framework**: لبناء واجهات برمجة التطبيقات (APIs)
- **Django Channels**: لدعم WebSockets والاتصالات غير المتزامنة
- **JWT Authentication**: المصادقة باستخدام JSON Web Tokens
- **SQLite**: قاعدة بيانات للتطوير (يمكن استبدالها بـ PostgreSQL للإنتاج)

## هيكل المشروع

```
Trello_Project/
├── frontend/                    # تطبيق React + Vite
│   ├── src/
│   │   ├── api/                 # تكوينات وخدمات API
│   │   ├── components/          # مكونات React القابلة لإعادة الاستخدام
│   │   ├── contexts/            # سياقات React (AuthContext, WebSocketContext)
│   │   └── pages/               # صفحات التطبيق
│   └── package.json             # تبعيات واجهة المستخدم
│
└── backend/                     # تطبيق Django
    ├── organizations/           # إدارة المؤسسات
    ├── projects/                # إدارة المشاريع
    ├── tasks/                   # إدارة المهام والتعليقات
    ├── users/                   # إدارة المستخدمين والمصادقة
    ├── trello_backend/          # إعدادات Django الرئيسية
    └── requirements.txt         # تبعيات الخادم الخلفي
```

## نماذج قاعدة البيانات الرئيسية

### المؤسسات (Organizations)
- تمثل الكيانات المنفصلة في النظام
- تحتوي على مستخدمين ومشاريع خاصة بها
- توفر عزل البيانات بين المؤسسات المختلفة

### المستخدمين (Users)
- يمتد من نموذج Django المدمج AbstractUser
- يحتوي على أدوار مختلفة (مالك النظام، مدير، مستخدم عادي)
- ينتمي إلى مؤسسة محددة

### المشاريع (Projects)
- تنتمي إلى مؤسسة محددة
- لها مالك من المستخدمين
- تحتوي على مجموعة من المهام

### المهام (Tasks)
- تنتمي إلى مشروع محدد
- يمكن تعيينها لمستخدم
- لها حالة (قيد الانتظار، قيد التنفيذ، مكتملة)
- يمكن أن تحتوي على تعليقات

## إعداد المشروع بعد تنزيله من GitHub

### 1. متطلبات النظام

- **Python 3.8+**
- **Node.js 14+**
- **PostgreSQL 12+**
- **Git**

### 2. تنزيل المشروع

```bash
# نسخ المشروع من GitHub
git clone https://github.com/your-username/Trello_Project.git
cd Trello_Project
```

### 3. إعداد الخادم الخلفي (Backend)

```bash
# الانتقال إلى مجلد الخادم الخلفي
cd backend

# إنشاء بيئة افتراضية (اختياري لكن موصى به)
python -m venv venv

# تفعيل البيئة الافتراضية
# في Windows
venv\Scripts\activate
# في Linux/Mac
source venv/bin/activate

# تثبيت التبعيات
pip install -r requirements.txt
```

### 4. إعداد قاعدة البيانات

#### 4.1 إنشاء قاعدة بيانات PostgreSQL

```bash
# تأكد من تثبيت PostgreSQL وتشغيله
# ثم قم بإنشاء قاعدة بيانات جديدة
# في Windows يمكنك استخدام pgAdmin
# أو في سطر الأوامر
psql -U postgres
CREATE DATABASE trello_project;
\q
```

#### 4.2 تكوين إعدادات قاعدة البيانات

قم بإنشاء ملف `.env` في مجلد `backend` بالمحتوى التالي:

```
SECRET_KEY=your-secret-key-here
DEBUG=True
DB_NAME=trello_project
DB_USER=postgres
DB_PASSWORD=postgres
DB_HOST=localhost
DB_PORT=5432
```

### 5. تطبيق الهجرات وإعداد البيانات الأولية

```bash
# تطبيق الهجرات لإنشاء هيكل قاعدة البيانات
python manage.py migrate

# إعداد البيانات الأولية (المؤسسات ومستخدم مشرف النظام)
python manage.py setup_initial_data
```

> **ملاحظة هامة**: أمر `setup_initial_data` سيقوم بإنشاء:
> - المؤسسة الرئيسية
> - المؤسسة الافتراضية
> - مستخدم مشرف النظام (admin/admin123)

### 6. إعداد الواجهة الأمامية (Frontend)

```bash
# الانتقال إلى مجلد الواجهة الأمامية
cd ../frontend

# تثبيت التبعيات
npm install
```

### 7. تشغيل المشروع

#### 7.1 تشغيل الخادم الخلفي

```bash
# في مجلد backend
python manage.py runserver
```

#### 7.2 تشغيل الواجهة الأمامية

```bash
# في مجلد frontend
npm run dev
```

### 8. الوصول إلى النظام

- **الخادم الخلفي**: http://localhost:8000/
- **واجهة المستخدم**: http://localhost:5173/
- **لوحة الإدارة**: http://localhost:8000/admin/

### 9. تسجيل الدخول

يمكنك تسجيل الدخول باستخدام بيانات مستخدم مشرف النظام الذي تم إنشاؤه تلقائياً:

- **اسم المستخدم**: `admin`
- **كلمة المرور**: `admin123`

> **تنبيه أمني**: يجب تغيير كلمة المرور الافتراضية فوراً في بيئة الإنتاج!

## استكشاف الأخطاء وإصلاحها

### مشكلة: لا يمكن الوصول إلى المؤسسات أو إنشاء حسابات جديدة

إذا واجهت مشكلة في جلب قائمة المؤسسات أو إنشاء حسابات جديدة، قد تكون المشكلة في المؤسسة الافتراضية. لحل هذه المشكلة:

```bash
# في مجلد backend
python manage.py setup_initial_data
```

هذا الأمر سيتحقق من وجود المؤسسة الافتراضية وإنشائها إذا لم تكن موجودة.

### مشكلة: نسيان كلمة مرور مالك النظام

إذا نسيت كلمة مرور مالك النظام، يمكنك إعادة تعيينها باستخدام الأمر التالي:

```bash
# في مجلد backend
python manage.py reset_admin_password
```

### مشكلة: تعارض في المؤسسات الافتراضية

إذا كنت تواجه مشاكل مع وجود مؤسسات افتراضية متعددة، يمكنك توحيدها باستخدام:

```bash
# في مجلد backend
python manage.py fix_default_organizations
```

### مشكلة: لا يوجد مستخدم مالك للنظام

إذا لم يكن هناك مستخدم بصلاحيات مالك النظام، يمكنك إنشاء واحد باستخدام:

```bash
# في مجلد backend
python manage.py create_system_owner
```
او انشى سوبر ادمن 
python manage.py createsuperuser

سيطلب منك الأمر إدخال اسم المستخدم وكلمة المرور والبريد الإلكتروني.

### مشكلة: خطأ في الاتصال بقاعدة البيانات

للتحقق من إعدادات الاتصال بقاعدة البيانات:

```bash
# في مجلد backend
python db_connection_test.py
```

## أوامر إدارية مفيدة

### إدارة المؤسسات والمستخدمين

```bash
# إعداد البيانات الأولية (المؤسسات ومستخدم مشرف النظام)
python manage.py setup_initial_data

# إصلاح المؤسسات الافتراضية وتوحيدها
python manage.py fix_default_organizations

# إنشاء مستخدم مالك للنظام
python manage.py create_system_owner

# إعادة تعيين كلمة مرور المشرف
python manage.py reset_admin_password
```

### إدارة قاعدة البيانات

```bash
# عمل نسخة احتياطية من قاعدة البيانات
python manage.py dumpdata > db_backup.json

# استعادة قاعدة البيانات من نسخة احتياطية
python manage.py loaddata db_backup.json

# تصدير المؤسسات فقط
python manage.py dumpdata organizations > organizations_backup.json
```

## نظام الصلاحيات

### عزل البيانات
- لا يمكن للمستخدم رؤية أي بيانات خارج مؤسسته
- يتم تطبيق العزل على مستوى قاعدة البيانات وواجهة المستخدم

### صلاحيات المهام
- **إنشاء مهمة**: متاح لأي عضو داخل المشروع
- **تعديل مهمة**: متاح للمستخدم المعين للمهمة أو مالك المشروع أو المدير
- **تغيير حالة المهمة**: متاح للمستخدم المعين للمهمة
- **حذف المهمة**: متاح فقط لمالك المشروع أو المدير

### صلاحيات المشاريع
- **إنشاء مشروع**: متاح لأي مستخدم داخل المؤسسة
- **تعديل/حذف مشروع**: متاح فقط لمالك المشروع أو المدير

## نظام التحديثات الفورية

يستخدم المشروع WebSockets لتوفير تحديثات فورية للمستخدمين:

- **اتصال WebSocket الرئيسي**: `ws://server/ws/?token={jwt_token}`
- **الاشتراك في تحديثات المشروع**: يتم إرسال رسالة اشتراك بعد الاتصال
- **معالجة الأحداث**: يتم استخدام نظام مستمعي الأحداث لمعالجة التحديثات الواردة

## ميزات واجهة المستخدم

- **لوحة المشاريع**: عرض جميع المشاريع المتاحة للمستخدم
- **لوحة المهام**: عرض المهام مقسمة حسب الحالة (Kanban Board)
- **تفاصيل المهمة**: نافذة منبثقة لعرض وتعديل تفاصيل المهمة
- **نظام التعليقات**: إمكانية إضافة وتعديل التعليقات على المهام
- **إدارة المستخدمين**: واجهة لإدارة المستخدمين داخل المؤسسة
- **إدارة المؤسسات**: واجهة لإدارة المؤسسات (للمدراء فقط)

## الأمان والخصوصية

- **مصادقة JWT**: استخدام JSON Web Tokens للمصادقة
- **عزل البيانات**: فصل تام للبيانات بين المؤسسات المختلفة
- **تحقق من الصلاحيات**: تحقق شامل من صلاحيات المستخدم على مستوى الخادم وواجهة المستخدم

## الترخيص
هذا المشروع ملكية خاصة وسرية.
